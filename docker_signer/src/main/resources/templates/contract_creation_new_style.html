<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap Layout</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <style>
        body, html {
            height: 100%;
            margin: 0;
        }
        .wrapper {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        header {
            height: 60px; /* Fixed header height */
        }
        footer {
            height: 50px; /* Fixed footer height */
        }
        main {
            flex: 1;
            overflow-y: auto;
        }
        i.big-icon{
            font-size: 50px;
        }
        .header-logo {
            height: 100%;
            max-height: 100%; /* Ensure it doesn't exceed the header */
            width: auto; /* Maintain aspect ratio */
            object-fit: contain; /* Keeps the whole logo visible */
        }



        .background-container {
            position: relative;
            overflow: hidden; /* ensures pseudo-element doesn't spill out */
            z-index: 0;
            /*padding: 50px;*/
            text-align: center;
            color: white;
            width: 100%;
        }

        .background-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /*background-image: url('https://static.wixstatic.com/media/d3bb5c_6979d0ede6394f9c8b620368f35a2903~mv2.jpg/v1/fill/w_345,h_140,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/MedSecurance_web_logo.jpg');
            background-repeat: repeat; /* repeat the image */
            /*background-size: 40px; /* adjust as needed */
            /*background-position: 50px 50px;*/
            background-color: lightgrey;
            filter: grayscale(100%) opacity(0.3); /* black & white + light effect */
            z-index: -1; /* put behind content */
        }

        h2.carousel-item-title {
            min-height: 2em;
        }

        h1.carousel-title {
            min-height: 2em;
            align-content: end;
        }

        .carousel-item-content {
            display: flex;
            flex-flow: column;
            height: 100%;
        }

        .carousel-item-content-title {
            flex: 0 1 auto;
        }

        .carousel-item-content-main {
            flex: 1 1 auto;
        }

        .carousel-item-content-footer {
            flex: 0 1 auto;
        }


    </style>
</head>
<body>
<div class="wrapper">
    <!--<header class="bg-white border-5 border-bottom d-flex align-items-center justify-content-center">
        <div class="container h-100 mh-100">
            <div class="row h-100 mh-100">
                <div class="col-2 h-100 mh-100">
                    <img class="header-logo" src="https://static.wixstatic.com/media/d3bb5c_6979d0ede6394f9c8b620368f35a2903~mv2.jpg/v1/fill/w_345,h_140,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/MedSecurance_web_logo.jpg">
                </div>
                <div class="col-8  justify-content-center mx-auto text-center" style="font-size: 40px; font-family: Arial, sans-serif;">Contract tool</div>
            </div>
        </div>
    </header>-->

    <header class="bg-white border-5 border-bottom d-flex align-items-center justify-content-center">
        <a th:href="@{'/' + ${project} + '/'}" class="col-8  justify-content-center mx-auto text-center"
           style="
             display: block;
           font-size: 40px;
           font-family: Arial, sans-serif;
           background-image: url('https://static.wixstatic.com/media/d3bb5c_6979d0ede6394f9c8b620368f35a2903~mv2.jpg/v1/fill/w_345,h_140,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/MedSecurance_web_logo.jpg');
           background-repeat: no-repeat;
           background-size: auto 60px;
           cursor: pointer;
           color: inherit;
        ">Contract tool</a>
        <!--<div class="container h-100 mh-100">
            <div class="row h-100 mh-100">
                <div class="col-2 h-100 mh-100">
                    <img class="header-logo" src="https://static.wixstatic.com/media/d3bb5c_6979d0ede6394f9c8b620368f35a2903~mv2.jpg/v1/fill/w_345,h_140,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/MedSecurance_web_logo.jpg">
                </div>

            </div>
        </div>-->
    </header>
    <main class="container-flex background-container m-0 d-flex">
        <div class="container-flex py-5 w-100 justify-content-center h-100">
            <div id="carouselExampleControls" class="carousel carousel-dark slide h-100" data-bs-interval="false" data-bs-wrap="false" data-ri>
                <div class="carousel-indicators">
                    <!--/*@thymesVar id="documents" type="edu.upc.dmag.signinginterface.KnownDocuments[]"*/-->
                    <button
                            th:each="document, iter : ${documents}"
                            type="button"
                            data-bs-target="#carouselExampleControls"
                            th:attr="data-bs-slide-to=${iter.index}, aria-label=${document.getName()}"
                            data-bs-slide-to="0"
                            th:classappend="${iter.first} ? 'active'"
                            aria-current="true"
                            aria-label="CEA model"
                    ></button>
                    <!--/*@thymesVar id="documents" type="edu.upc.dmag.signinginterface.KnownDocuments[]"*/-->
                    <button
                            type="button"
                            data-bs-target="#carouselExampleControls"
                            th:attr="data-bs-slide-to=${#arrays.length(documents)}"
                            aria-label="submit"></button>
                </div>


                <div class="carousel-inner h-100">
                    <!-- th:object="${document}"  -->
                    <!--/*@thymesVar id="documents" type="edu.upc.dmag.signinginterface.KnownDocuments[]"*/-->
                    <div th:each="document, iter : ${documents}" class="carousel-item h-100" th:classappend="${iter.first} ? 'active'" style="background-color: white">
                        <h1 ></h1>
                        <div class="carousel-item-content">
                            <div class="carousel-item-content-title">
                                <h1 class="carousel-title" th:text="${document.getCaption()}" style="color: black"></h1>
                                <h2 style="color: black" class="carousel-item-title" th:text="${document.getGoal()}"></h2>
                            </div>
                            <div class="carousel-item-content-main">
                                <div
                                        th:id="${document.getDropZoneId()}"
                                        th:attr="file_entry=${document.name()}"
                                        class="border border-secondary rounded p-5 text-center bg-light h-100 d-flex flex-column justify-content-center align-items-center"
                                        style="cursor: pointer; transition: background 0.3s; flex-grow: 1">
                                    <i th:id="${document.getIconId()}" class="bi bi-cloud-arrow-up fs-1 text-primary"></i>

                                    <p th:id="${document.getFeedbackId()}"
                                       class="mt-3 mb-0"
                                       style="color: black"
                                       th:if="${s3Objects[document.name()]} == null">
                                        Drag &amp; drop a file here or
                                        <span class="text-primary">click to upload</span>
                                    </p>

                                    <p th:id="${document.getFeedbackId()}"
                                       class="mt-3 mb-0"
                                       style="color: black"
                                       th:if="${s3Objects[document.name()]} != null"
                                       th:inline="text">
                                        A file has been uploaded [[${#dates.format(s3Objects[document.name()].lastModified(), 'dd/MM/yyyy HH:mm')}]]. Drag &amp; drop a file here or
                                        <span class="text-primary">click to upload a new version</span>
                                    </p>

                                    <div class="progress" style="width: 50%; display: none" th:id="${document.getProgressContainerId()}">
                                        <div th:id="${document.getProgressId()}" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <input type="file" th:attr="file_entry=${document.name()}" th:id="${document.getId()}" th:name="${document.getId()}" hidden>
                                </div>
                            </div>

                            <div class="carousel-item-content-footer">
                                <div  style="text-align: center" class="mt-3 text-white"></div>
                            </div>
                        </div>
                    </div>

                    <div class="carousel-item h-100" style="background-color: white">
                        <div class="carousel-item-content">
                            <div class="carousel-item-content-title">
                                <h1 class="carousel-title" style="color: black">Submit?</h1>
                                <h2 style="color: black" class="carousel-item-title">(submit and download the contract without signatures)</h2>
                            </div>
                            <div class="carousel-item-content-main">
                                <div
                                        class="border border-secondary rounded p-5 text-center bg-light h-100 d-flex flex-column justify-content-center align-items-center"
                                        style="cursor: pointer; transition: background 0.3s; flex-grow: 1">
                                    <a th:href="@{'/' + ${project} + '/generateUnsignedContract'}" download>
                                        <button>Download XML</button>
                                    </a>
                                </div>
                            </div>
                            <div class="carousel-item-content-footer">
                                <div  style="text-align: center" class="mt-3 text-white"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </main>

    <footer class="bg-dark text-white d-flex align-items-center justify-content-center"
            style=" font-family: Arial, sans-serif;"
    >
        MedSecurance Toolbox
    </footer>
    </div>

    <!-- Bootstrap JS (Optional, for components) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script th:inline="javascript">
        // Inject Java objects
        const uploadable_files = /*[[${T(edu.upc.dmag.signinginterface.KnownDocuments).getMap()}]]*/ [];


        uploadable_files.forEach( element_names => {
            const dropZone = document.getElementById(element_names["dropZone_name"]);
            const fileInput = document.getElementById(element_names["fileInput_name"]);
            const progressContainer = document.getElementById(element_names["progress_container_id"]);
            const progressBar = document.getElementById(element_names["progress_id"]);
            const feedback = document.getElementById(element_names["feedback_id"]);
            const icon = document.getElementById(element_names["icon"]);

            // When clicking the drop zone, trigger the hidden file input
            dropZone.addEventListener('click', () => fileInput.click());

            // Handle file selection
            fileInput.addEventListener('change', () => {
                const file_entry = fileInput.getAttribute("file_entry");
                if (fileInput.files.length > 0) {
                    uploadFile(fileInput.files[0], file_entry);
                }
            });

            // Drag-over styling
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('bg-primary', 'bg-opacity-10');
            });

            // Remove drag-over styling
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('bg-primary', 'bg-opacity-10');
            });

            // Handle dropped file
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('bg-primary', 'bg-opacity-10');

                const file = e.dataTransfer.files[0];
                const file_entry = dropZone.getAttribute("file_entry");
                if (file) uploadFile(file, file_entry);
            });

// Upload function
            function uploadFile(file, filename) {
                feedback.textContent = "Uploading...";
                progressContainer.style.display = "flex";
                progressBar.style.width = "0%";
                progressBar.setAttribute("aria-valuenow", 0);
                var project=/*[[${project}]]*/"";


                const formData = new FormData();
                formData.append("file", file);

                const xhr = new XMLHttpRequest();
                xhr.open("POST", "/upload/large/"+project+"/"+filename);  // <-- CHANGE TO YOUR ENDPOINT

                // Progress handler
                xhr.upload.onprogress = (event) => {
                    if (event.lengthComputable) {
                        const percent = Math.round((event.loaded / event.total) * 100);
                        progressBar.style.width = percent + "%";
                        progressBar.setAttribute("aria-valuenow", percent);
                    }
                };

                // On complete
                xhr.onload = () => {
                    if (xhr.status === 200) {


                        icon.className = "bi bi-file-earmark-medical fs-1 text-primary";

                        feedback.textContent = `Dropped file: ${file.name}`;
                        feedback.appendChild(document.createElement('br'));
                        feedback.appendChild(document.createTextNode('Drag & drop a file here or '));

                        const span = document.createElement('span');
                        span.className = 'text-primary';
                        span.textContent = 'click to change the uploaded file';
                        feedback.appendChild(span);
                    } else {
                        feedback.textContent = "Upload failed!";
                    }
                };

                xhr.onerror = () => {
                    feedback.textContent = "Error uploading file.";
                };

                xhr.send(formData);
            }
        })
    </script>
</body>
</html>